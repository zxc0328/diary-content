## 长列表渲染

之前在面试的时候被问到一个问题，就是如何在移动端渲染一个长列表。那个时候还不明所以。知道用了iOS的tableView之后，知道了有一招，回收利用tableCell。

在DOM base的web页面里，所对应的其实就是控制DOM节点的数量，只让viewport中会出现的DOM节点以及附近的节点出现，而在viewport之外的节点压根就不用在页面上存在。我们可以打开看一下Clusterize.js的[主页](https://clusterize.js.org)看一下有5000个节点列表的页面，滚动起来是有多卡。

比如一个Vue组件，data是一个数组，用这个数组来渲染一个组件list。比如我们规定最多同时只能存在20个list，这些list我们按5个分为一组。那么当滑动到最后一组（16-20个）的时候，我们就要加载21-25这组内容。此时我们会移除1-5这最开始的一组组件。

有一个问题，移除DOM节点之后整个页面会往上移动。这样显然是不行的。我们对DOM的移除不能被用户察觉。

解决办法就是在list的上方放一个DOM节点。初始高度为0.当移除一组节点时，这个占位节点的高度就相应的增加，来占之前节点的位置。如果操作得当，增加高度和删除节点在一次浏览器的渲染周期，也就是16ms内完成，那用户是无法察觉的。而且因为高度占位，滚动条也是正确的。

当然往回滚动时就变成了减少占位节点的高度了。

这个理论应该是没有问题的。大家可以实践一下试试。

### Links

+ [Clusterize.js](https://clusterize.js.org)
+ [react-scrollable-list](https://github.com/jwarning/react-scrollable-list)